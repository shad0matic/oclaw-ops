# Bookmark Categorization Workflow

## Overview

The bookmark categorization system allows the main agent to interactively categorize browser bookmarks via Telegram. This is Phase 4 of the Browser Bookmark Import Pipeline.

## How It Works

### 1. Fetch Bookmarks Ready for Categorization

```bash
curl -X POST http://localhost:3000/api/browser-bookmarks/categorize?batch=5
```

This returns bookmarks that have been summarized but not yet assigned to folders:

```json
{
  "success": true,
  "processed": 5,
  "sent": 5,
  "bookmarks": [
    {
      "id": 123,
      "url": "https://example.com/article",
      "title": "Cool Article",
      "summary": "**Summary:** This article discusses...\n\n**Key Points:**\n- Point 1\n- Point 2\n\n**Tags:** tech, ai, tutorial",
      "tags": ["tech", "ai", "tutorial"]
    }
  ],
  "folders": [
    {
      "id": 1,
      "name": "Tech Articles",
      "description": "Technical articles and tutorials",
      "parent_id": null
    }
  ]
}
```

### 2. Send Interactive Prompt via Telegram

The main agent should send a message to the user with:
- Bookmark title and URL
- Summary
- Suggested tags
- List of available folders
- Options to:
  - Select existing folder
  - Create new folder
  - Skip/ignore

Example prompt:
```
üîñ New Bookmark to Categorize

**Cool Article**
https://example.com/article

üìù Summary:
This article discusses AI and machine learning concepts...

Key Points:
‚Ä¢ Point 1
‚Ä¢ Point 2

üè∑Ô∏è Suggested Tags: tech, ai, tutorial

üìÅ Available Folders:
1. Tech Articles
2. AI Research
3. Tutorials

Choose an option:
A) Assign to folder (reply with number)
B) Create new folder (reply with folder name)
C) Skip for now
```

### 3. Process User Response

Once the user responds, use the PATCH endpoint to assign the bookmark:

#### Assign to Existing Folder
```bash
curl -X PATCH http://localhost:3000/api/browser-bookmarks/categorize \
  -H "Content-Type: application/json" \
  -d '{
    "bookmarkId": 123,
    "folderId": 1
  }'
```

#### Create New Folder and Assign
```bash
curl -X PATCH http://localhost:3000/api/browser-bookmarks/categorize \
  -H "Content-Type: application/json" \
  -d '{
    "bookmarkId": 123,
    "createFolder": {
      "name": "New Folder",
      "description": "Description of the folder",
      "parentId": null
    }
  }'
```

## Integration with Main Agent

The main agent can run this as part of the heartbeat or on-demand:

1. Check if there are bookmarks ready for categorization
2. Fetch a batch (e.g., 5 at a time)
3. Send interactive prompts to Telegram
4. Store pending responses in a temporary state
5. When user responds, assign bookmarks to folders
6. Repeat until all bookmarks are categorized

## Automation Options

### Via Cron Job

Create a cron job that runs every 6 hours to prompt for categorization:

**Name:** Bookmark Categorization Prompt  
**Schedule:** `0 */6 * * *` (every 6 hours)  
**Prompt:**
```
Check for bookmarks ready for categorization. Fetch up to 5 bookmarks using:
POST /api/browser-bookmarks/categorize?batch=5

For each bookmark, send me an interactive categorization prompt via Telegram with the summary and folder options. Wait for my response to assign them.
```

### Via Telegram Command

The user can manually trigger categorization by sending:
```
/categorize-bookmarks
```

The agent should:
1. Fetch pending bookmarks
2. Send interactive prompts
3. Wait for responses
4. Assign bookmarks

## Database Schema

The categorization workflow uses these tables:

- `ops.browser_bookmarks` - Contains URLs, summaries, and folder assignments
- `ops.bookmark_folders` - Hierarchical folder structure

Key fields:
- `browser_bookmarks.kb_folder_id` - Foreign key to bookmark_folders
- `browser_bookmarks.boss_categorized` - Flag to indicate if sent for categorization
- `browser_bookmarks.summary` - L1 summary generated by Gemini Flash
- `browser_bookmarks.tags` - Array of suggested tags

## Best Practices

1. **Batch Processing:** Don't send more than 5-10 bookmarks at once to avoid overwhelming the user
2. **Smart Suggestions:** Use the tags and summary to pre-suggest folders
3. **Folder Creation:** Allow creating new folders on the fly for better organization
4. **Skip Option:** Let users skip bookmarks they're unsure about
5. **Resume Later:** Store state so categorization can be resumed across sessions
